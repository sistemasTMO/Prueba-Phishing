<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Registro</title>
    <link rel="stylesheet" href="style.css"> <!-- Archivo de estilos -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>
<body>
    <header>
        <nav>
            <h1>GRAN RIFA SORPRESA DEL MES DE FEBRERO</h1>
            <p>Realiza el llenado del formulario para completar tu registro.</p>
            <p>Al registrarte, toma captura, toma una fotografía o anota el número de boleto que te tocó ya que es con el que participarás en la rifa.</p>
        </nav>
    </header>

    <!-- Imágenes de los premios esparcidas -->
    <img src="Mac.jpg" alt="MacBook Pro" class="premio premio1" title="1er Lugar: MacBook Pro M3 Max (16´, 1TB SSD, 32GB RAM)">
    <img src="Samsung.jpg" alt="Samsung Galaxy S23" class="premio premio2" title="2do Lugar: Samsung Galaxy S23 (256GB)">
    <img src="xiaomi.jpg" alt="Xiaomi Redmi Note 12" class="premio premio3" title="3er Lugar: Xiaomi Redmi Note 12 (64GB)">

    <div class="container">
        <h2>Formulario de Registro</h2>
        <form id="contactForm">
            <div class="form-group">
                <label for="nombre">Nombre Completo</label>
                <input type="text" id="nombre" name="nombre" required placeholder="Nombre Completo">
            </div>
            <div class="form-group">
                <label for="correo">Correo Electrónico</label>
                <input type="email" id="correo" name="correo" required placeholder="Correo Electrónico">
            </div>
            <div class="form-group">
                <label for="fechaNacimiento">Fecha de Nacimiento</label>
                <input type="date" id="fechaNacimiento" name="fechaNacimiento" required>
            </div>
            <div class="form-group">
                <label for="puesto">Puesto</label>
                <input type="text" id="puesto" name="puesto" required placeholder="Puesto">
            </div>
            <div class="form-group">
                <label for="domicilio">Domicilio</label>
                <input type="text" id="domicilio" name="domicilio" required placeholder="Domicilio">
            </div>
            <div class="form-group">
                <label for="telefono">Número Celular</label>
                <input type="text" id="celular" name="telefono" required placeholder="Celular">
            </div>
            <button type="button" id="sendEmailButton" class="submit-btn">Registrar</button>
        </form>
    </div>

    <!-- Ventana Modal - Confirmación de Registro y Folio -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <p id="statusMessage"></p>
            <p id="folioMessage"></p>
            <button id="closeModal">Aceptar</button>
        </div>
    </div>

    <!-- Ventana Modal - Premios -->
    <div id="modalPremios" class="modal">
        <div class="modal-content">
            <h2>¡Premios de la Rifa!</h2>
            <ul>
                <li>1er Lugar: MacBook Pro M3 Max (16", 1TB SSD, 32GB RAM)</li>
                <li>2do Lugar: Samsung Galaxy S23 (256GB)</li>
                <li>3er Lugar: Xiaomi Redmi Note 12 (64GB)</li>
            </ul>
            <button id="closePremiosModal">Cerrar</button>
        </div>
    </div>

    <script>
        emailjs.init("HTqRs07b7pKU4UVmH");

        document.getElementById("sendEmailButton").addEventListener("click", function () {
            const nombre = document.getElementById("nombre").value.trim();
            const correo = document.getElementById("correo").value.trim();
            const fechaNacimiento = document.getElementById("fechaNacimiento").value.trim();
            const puesto = document.getElementById("puesto").value.trim();
            const domicilio = document.getElementById("domicilio").value.trim();
            const telefono = document.getElementById("celular").value.trim();
            const statusMessage = document.getElementById("statusMessage");
            const folioMessage = document.getElementById("folioMessage");
            const modal = document.getElementById("modal");

            if (!nombre || !correo || !fechaNacimiento || !puesto || !domicilio || !telefono) {
                statusMessage.textContent = "Todos los campos son obligatorios.";
                statusMessage.style.color = "red";
                folioMessage.textContent = "";
                modal.style.display = "flex";
                return;
            }

            let folioGenerado = localStorage.getItem("ultimoFolio");
            folioGenerado = folioGenerado ? parseInt(folioGenerado) + 1 : 1;
            localStorage.setItem("ultimoFolio", folioGenerado);

            const adminEmail = "sistemastmo@troqueladosmodulares.com.mx"; 

            const formDataAdmin = {
                folio: folioGenerado.toString(),
                nombre: nombre,
                correo: correo,
                fechaNacimiento: fechaNacimiento,
                puesto: puesto,
                domicilio: domicilio,
                telefono: telefono
            };

            const formDataUser = {
                folio: folioGenerado.toString(),
                correo: correo
            };

            emailjs.send("service_t6376ic", "template_tl9wl6r", formDataAdmin)
                .then(function () {
                    emailjs.send("service_t6376ic", "template_usuario", formDataUser)
                        .then(function () {
                            statusMessage.textContent = "¡Registrado exitosamente!";
                            statusMessage.style.color = "green";
                            folioMessage.textContent = "Tu número de boleto es: " + folioGenerado;
                            folioMessage.style.color = "blue";
                            modal.style.display = "flex";
                            document.getElementById("contactForm").reset();
                        })
                        .catch(function () {
                            statusMessage.textContent = "Error al enviar el boleto.";
                            statusMessage.style.color = "red";
                            modal.style.display = "flex";
                        });
                })
                .catch(function () {
                    statusMessage.textContent = "Error al registrar. Intenta de nuevo.";
                    statusMessage.style.color = "red";
                    modal.style.display = "flex";
                });
        });

        document.getElementById("closeModal").addEventListener("click", function () {
            document.getElementById("modal").style.display = "none";
        });

        document.getElementById("closePremiosModal").addEventListener("click", function () {
            document.getElementById("modalPremios").style.display = "none";
        });
    </script>
</body>
</html>
